{"version":3,"file":"69shuba auto 書簽.user.js","sources":["69shuba auto 書簽.user.ts"],"sourcesContent":["/// <reference path = \"./../Tools/Tools.user.d.ts\" />\n// ==UserScript==\n// @name         69shuba auto 書簽\n// @namespace    Paul-16098\n// @version      3.5.13.0\n// @description  自動書籤,更改css,可以在看書頁找到作者連結\n// @author       Paul-16098\n// #tag 69shux.com\n// @match        https://69shux.com/txt/*/*\n// @match        https://69shux.com/txt/*/end.html\n// @match        https://69shux.com/book/*.htm*\n// @match        https://69shux.com/modules/article/bookcase.php*\n// #tag www.69shu.top\n// @match        https://www.69shu.top/txt/*/*\n// @match        https://www.69shu.top/txt/*/end.html\n// @match        https://www.69shu.top/book/*.htm*\n// @match        https://www.69shu.top/modules/article/bookcase.php*\n// #tag www.69shu.cx\n// @match        https://www.69shu.cx/txt/*/*\n// @match        https://www.69shu.cx/txt/*/end.html\n// @match        https://www.69shu.cx/book/*.htm*\n// @match        https://www.69shu.cx/modules/article/bookcase.php*\n// #tag 69shuba.cx\n// @match        https://69shuba.cx/txt/*/*\n// @match        https://69shuba.cx/txt/*/end.html\n// @match        https://69shuba.cx/book/*.htm*\n// @match        https://69shuba.cx/modules/article/bookcase.php*\n// #tag www.69shuba.pro\n// @match        https://www.69shuba.pro/txt/*/*\n// @match        https://www.69shuba.pro/txt/*/end.html\n// @match        https://www.69shuba.pro/book/*.htm*\n// @match        https://www.69shuba.pro/modules/article/bookcase.php*\n// #tag 69shuba.me\n// @match        https://69shu.me/txt/*/*\n// @match        https://69shu.me/txt/*/end.html\n// @match        https://69shu.me/book/*.htm*\n// @match        https://69shu.me/modules/article/bookcase.php*\n// #tag 69shu.biz\n// @match        https://69shu.biz/c/*/*\n// @match        https://69shu.biz/c/*/end.html\n// @match        https://69shu.biz/b/*.htm*\n// @match        https://69shu.biz/modules/article/bookcase.php*\n// #tag www.69yuedu.net\n// @match        https://www.69yuedu.net/r/*/*.html*\n// @match        https://www.69yuedu.net/article/*.html*\n// @match        https://www.69yuedu.net/modules/article/bookcase.php*\n// #tag www.69shuba.com\n// @match        https://www.69shuba.com/txt/*/*\n// @match        https://www.69shuba.com/modules/article/bookcase.php*\n// @match        https://www.69shuba.com/book/*.htm\n// #tag twkan.com\n// @match        https://twkan.com/txt/*/*\n// @match        https://twkan.com/bookcase*\n// @match        https://twkan.com/book/*.html\n\n// @icon         https://www.google.com/s2/favicons?sz=64&domain=69shuba.com\n// @grant        window.close\n// @grant        GM_addStyle\n// @grant        GM_getValue\n// @grant        GM_setValue\n// @grant        unsafeWindow\n// @grant        GM_registerMenuCommand\n// @grant        GM_openInTab\n// @grant        GM_getResourceText\n// @run-at       document-idle\n//#if debug\n// #@require file://C:\\Users\\p\\Documents\\git\\userjs\\Tools\\Tools.user.js\n//#else\n// @require https://github.com/Paul-16098/userjs/raw/dev/Tools/Tools.user.js\n//#endif\n\n// @resource     css1 https://github.com/Paul-16098/userjs/raw/refs/heads/dev/69shuba%20auto%20%E6%9B%B8%E7%B0%BD/69shuba%20auto%20%E6%9B%B8%E7%B0%BD.user.css\n// @resource     replace_json https://github.com/Paul-16098/userjs/raw/dev/69shuba%20auto%20%E6%9B%B8%E7%B0%BD/replace.json\n// @license      MIT\n// @supportURL   https://github.com/Paul-16098/userjs/issues/\n// @homepageURL  https://github.com/Paul-16098/userjs/README.md\n// ==/UserScript==\n\n// 語言選項枚舉\nenum Language {\n  en = \"en\",\n  zh = \"zh\",\n}\n\n/**\n * 用戶配置類，負責管理腳本的各項設置，並註冊菜單。\n */\nclass Config {\n  /** 是否開啟偵錯模式 */\n  Debug: boolean = GM_getValue(\"Debug\", false);\n  /** 結束頁是否自動關閉 */\n  IsEndClose: boolean = GM_getValue(\"IsEndClose\", true);\n  /** 是否自動加入書櫃 */\n  AutoAddBookcase: boolean = GM_getValue(\"AutoAddBookcase\", true);\n  /** 自動加入書櫃的封鎖名單（書ID陣列） */\n  AutoAddBookcaseBlockade: Array<string> = GM_getValue(\n    \"AutoAddBookcaseBlockade\",\n    []\n  );\n  /** 是否攔截alert */\n  IsHookAlert: boolean = GM_getValue(\"IsHookAlert\", true);\n  /** 攔截alert的訊息封鎖名單 */\n  HookAlertBlockade: Array<Array<any>> = GM_getValue(\"HookAlertBlockade\", [\n    [\"添加成功\"],\n    [\"刪除成功!\"],\n    [\"恭喜您，该章节已经加入到您的书签！\"],\n  ]);\n  /** 語言設定 */\n  Language: Language = GM_getValue(\"Language\", Language.zh);\n\n  constructor() {\n    this.set();\n    this.registerConfigMenu();\n    return this;\n  }\n  /**\n   * 註冊所有配置項的菜單\n   */\n  private registerConfigMenu() {\n    for (const key in this) {\n      const value = this[key as keyof Config];\n      let menu = undefined;\n      // 語言切換菜單\n      if (Object.values(Language).includes(value as Language)) {\n        menu = () => {\n          Object.values(Language).forEach((lang) => {\n            if (lang !== value) {\n              GM_setValue(\"Language\", lang);\n              location.reload();\n            }\n          });\n        };\n      }\n      setMenu(key, menu, value, {\n        zh: \"中文\",\n        en: \"english\",\n        Debug: \"偵錯\",\n        AutoAddBookcase: \"自動添加書櫃\",\n        AutoAddBookcaseBlockade: \"自動添加書櫃封鎖\",\n        Language: \"語言\",\n        IsEndClose: \"結束後關閉\",\n        IsHookAlert: \"掛鉤Alert\",\n        HookAlertBlockade: \"掛鉤Alert封鎖\",\n      });\n    }\n  }\n  /**\n   * 將當前配置寫入GM存儲\n   */\n  private set() {\n    GM_setValue(\"Debug\", this.Debug);\n    GM_setValue(\"IsEndClose\", this.IsEndClose);\n    GM_setValue(\"AutoAddBookcase\", this.AutoAddBookcase);\n    GM_setValue(\"AutoAddBookcaseBlockade\", this.AutoAddBookcaseBlockade);\n    GM_setValue(\"IsHookAlert\", this.IsHookAlert);\n    GM_setValue(\"HookAlertBlockade\", this.HookAlertBlockade);\n    GM_setValue(\"Language\", this.Language);\n  }\n}\n\n// 配置初始化\nconst config: Config = new Config();\n\n// i18n 設定\nconst i18nData: typeof i18n.prototype.langJson = {\n  en: {\n    noMatchingPattern: \"No matching URL pattern found\",\n    errorOccurred: \"An error occurred: \",\n    noLabelsFound: \"No labels found, retrying in 5 seconds...\",\n    maxRetriesReached: \"Max retries reached. No labels found.\",\n    noUpdates: \"No updates\",\n    updatesAvailable: \" updates available\",\n  },\n  zh: {\n    noMatchingPattern: \"未找到匹配的 URL 模式\",\n    errorOccurred: \"發生了一些錯誤: \",\n    noLabelsFound: \"未找到標籤，5 秒後重試...\",\n    maxRetriesReached: \"已達到最大重試次數。未找到標籤。\",\n    noUpdates: \"沒有更新\",\n    updatesAvailable: \"個更新\",\n  },\n};\n\n// 書籍數據接口\ninterface BookData {\n  Updata: {\n    url: {\n      value: string;\n      URLParams: URLSearchParams;\n    };\n  };\n  Mate: {\n    BookName: string;\n    BookHtmlObj: Element;\n    BookImgUrl: string;\n  };\n}\n\nconst i18nInstance = new i18n(i18nData, config.Language);\nconst t = i18nInstance.t;\n\n/**\n * `BookManager` 類別提供了各種方法來管理網頁上與書籍相關的資料並與之互動。\n * 它包括偵測圖書頁面、圖書資訊頁面、結束頁面和書架頁面的功能。\n * 它還提供了處理導航、將書籍添加到書架以及修改頁面元素的方法。\n *\n * @class\n * @classdesc 此類旨在自動化並增強與圖書相關的網站的使用者體驗。\n *\n * @property {Object} data -包含用於偵測和處理書籍相關頁面的各種方法和模式。\n * @property {Function} data.HasBookInfo  -檢查是否可用書籍信息。\n * @property {Function} data.IsBookshelf  -檢查當前頁面是否是書架頁面。\n * @property {Object} data.Book  -包含與書籍操作有關的方法。\n * @property {Function} data.Book.GetAid  -檢索書ID。\n * @property {Function} data.Book.GetCid  -檢索章節ID。\n * @property {RegExp} data.Book.pattern  -標識書頁的模式。\n * @property {Function} data.Book.Is  -檢查當前頁面是否是書頁。\n * @property {Object} data.Info  -包含與書籍信息操作有關的方法。\n * @property {RegExp} data.Info.pattern  -識別圖書信息頁面的模式。\n * @property {Function} data.Info.Is  -檢查當前頁面是否是書籍信息頁面。\n * @property {Object} data.End  -包含與最終頁面操作相關的方法。\n * @property {Function} data.End.Is  -檢查當前頁面是否是結束頁面。\n * @property {Function} data.GetNextPageUrl  -檢索下一頁的URL。\n * @property {Function} data.IsNextEnd  -檢查下一頁是否是終點頁面。\n * @property {Function} data.IsBiz  -檢查當前域是否為“ 69shu.biz”。\n *\n * @constructor\n * @description 初始化 `Bookmanager` 類的新實例。它註冊了配置菜單並處理不同類型的頁面（書籍, 書籍信息, 結束, 書架）。如果設置了 `config.debug` 標誌, 它還記錄了調試信息。\n * @throws 如果發生錯誤並且未設置 `config.debug` , 將提醒用户。\n *\n * @method handleBookPage\n * @description 透過執行各種修改和增強來處理書籍頁面。\n * @private\n * @returns {void}\n *\n * @method hookAlert\n * @description 掛鈎全域「警報」功能以有條件地阻止或記錄警報訊息。\n * @private\n * @returns {void}\n *\n * @method addStyles\n * @description 透過從指定資源注入 CSS 內容, 將自訂樣式新增至文件。\n * @private\n * @returns {void}\n *\n * @method modifyPageNavigation\n * @description 透過刪除現有的「onkeydown」事件處理程序並新增新的「keydown」事件偵聽器來修改頁面導航。\n * @private\n * @returns {void}\n *\n * @method keydownHandler\n * @description 處理鍵盤事件, 以便在按下「向右箭頭」鍵時導覽至下一頁。\n * @private\n * @param {KeyboardEvent} e -鍵盤事件物件。\n * @returns {void}\n *\n * @method addBookcase\n * @description 將當前的書添加到書架中。\n * @private\n * @returns {void}\n *\n * @method insertAuthorLink\n * @description 插入作者鏈接並用新鏈接替換標題DIV。\n * @private\n * @returns {void}\n *\n * @method handleBookshelf\n * @description 通過收集書籍數據和註冊菜單命令來處理書架。\n * @private\n * @returns {Promise<void>}\n *\n * @method collectBookData\n * @description 通過以 `book_` 開頭查詢ID, 從DOM收集書籍數據。\n * @private\n * @param {number} [retryCount=0]  -當前的重試計數。\n * @returns {Promise<BookData[]>}  -解決一系列收集的書籍數據的承諾。\n *\n * @method registerMenuCommand\n * @description 註冊菜單命令, 其中包含收集的書籍數據。\n * @private\n * @param {BookData[]} bookData  -收集的書籍數據。\n * @returns {void}\n *\n * @method debugInfo\n * @description 收集和返回調試信息。\n * @private\n * @returns {Object}  -調試信息。\n *\n * @method registerConfigMenu\n * @description 註冊配置菜單。\n * @private\n * @returns {void}\n */\nclass BookManager {\n  /** 常用選擇器集合 */\n  SELECTORS = {\n    nextPage: [\n      \"body > div.container > div.mybox > div.page1 > a:nth-child(4)\",\n      \"body > div.mainbox > div > div.page1 > a:nth-child(4)\",\n    ],\n    authorInfo:\n      \"body > div.container > div.mybox > div.txtnav > div.txtinfo.hide720 > span:nth-child(2)\",\n    titleDiv: \"body > div.container > div.mybox > div.tools\",\n    searchInput:\n      \"body > header > div > form > div > div.inputbox > input[type=text]\",\n    searchForm: \"body > header > div > form\",\n  };\n  /**\n   * 各種頁面判斷與數據獲取方法集合\n   */\n  private data = {\n    // 判斷是否有書籍信息\n    HasBookInfo: typeof bookinfo !== \"undefined\",\n    // 判斷是否在書架頁面\n    IsBookshelf: (href: string = location.href) => {\n      if (this.data.IsTwkan) {\n        return new URL(href).pathname === \"/bookcase\";\n      } else {\n        return new URL(href).pathname === \"/modules/article/bookcase.php\";\n      }\n    },\n    // 書籍相關操作\n    Book: {\n      // 獲取書籍ID\n      GetAid: (href: string = window.location.href) => {\n        if (this.data.HasBookInfo) {\n          return bookinfo.articleid;\n        }\n        return href.split(\"/\")[4];\n      },\n      // 獲取章節ID\n      GetCid: (href: string = window.location.href) => {\n        if (this.data.HasBookInfo) {\n          return bookinfo.chapterid;\n        }\n        return href.split(\"/\")[5];\n      },\n      // 書籍URL模式\n      pattern: /^\\/(txt|c|r)\\/([0-9]|[a-z])+\\/([0-9]|[a-z])+(\\.html)?$/m,\n      // 判斷是否為書籍頁面\n      Is: (href: string = window.location.href) => {\n        return this.data.Book.pattern.test(new URL(href).pathname);\n      },\n    },\n    // 書籍信息相關操作\n    Info: {\n      // 書籍信息URL模式\n      pattern: /^\\/(book|b|article)\\/([0-9]|[a-z])+\\.htm(l)?$/m,\n      // 判斷是否為書籍信息頁面\n      Is: (pathname: string = window.location.pathname) => {\n        return this.data.Info.pattern.test(pathname);\n      },\n    },\n    // 結束頁面相關操作\n    End: {\n      // 判斷是否為結束頁面\n      Is: (href: string = window.location.href) => {\n        if (this.data.Info.Is()) {\n          const searchParams = new URL(href).searchParams;\n          return searchParams.get(\"FromBook\") === \"true\";\n        }\n        if (this.data.IsTwkan) {\n          let h = new URL(href);\n          if (\n            /txt\\/[0-9]+\\/end\\.html/.test(h.pathname) &&\n            h.searchParams.get(\"FromBook\") === \"true\"\n          ) {\n            return true;\n          } else {\n            return false;\n          }\n        }\n        return false;\n      },\n    },\n    // 獲取下一頁URL\n    GetNextPageUrl: () => {\n      const nextPageEle = this.getNextPageElement();\n      return nextPageEle?.href;\n    },\n    // 判斷下一頁是否為結束頁面\n    IsNextEnd: () => {\n      if (this.data.Book.Is()) {\n        const nextUrl = this.data.GetNextPageUrl();\n        if (nextUrl) {\n          return (\n            this.data.End.Is(nextUrl) ||\n            this.data.Info.Is(new URL(nextUrl).pathname)\n          );\n        }\n      }\n      return false;\n    },\n    // 判斷是否為69shu.biz域名\n    IsBiz: location.host === \"69shu.biz\",\n    // 判斷是否為twkan.com域名\n    IsTwkan: location.host === \"twkan.com\",\n  };\n\n  /**\n   * 取得下一頁的a元素\n   */\n  getNextPageElement(): HTMLAnchorElement | null {\n    for (const selector of this.SELECTORS.nextPage) {\n      const element = document.querySelector(\n        selector\n      ) as HTMLAnchorElement | null;\n      if (element && element.href) return element;\n    }\n    // 備用方案：尋找文字為\"下一章\"的連結\n    return Array.from(document.querySelectorAll(\"a\")).find(\n      (link) => link.textContent === \"下一章\"\n    ) as HTMLAnchorElement | null;\n  }\n\n  /**\n   * 構造函數，根據當前頁面自動分派對應處理\n   */\n  constructor() {\n    try {\n      if (config.Debug) {\n        console.debug(this.debugInfo());\n      }\n\n      // #tag search\n      const search = new URLSearchParams(location.search).get(\"q\");\n      if (search) this.performSearch(search);\n\n      // #tag BookEnd\n      if (this.data.End.Is()) {\n        if (config.Debug) console.log(\"End page detected\");\n        if (config.IsEndClose) window.close();\n      }\n      // #tag Book\n      if (this.data.Book.Is()) {\n        if (config.Debug) console.log(\"Book page detected\");\n        this.handleBookPage();\n      }\n      // #tag Info\n      if (this.data.Info.Is()) {\n        if (config.Debug) console.log(\"Book info page detected\");\n        let Ele = document.querySelector(\n          \"body > div.container > ul > li.col-8 > div:nth-child(2) > ul > li:nth-child(2) > a\"\n        ) as HTMLAnchorElement | null;\n        if (Ele) {\n          Ele.click();\n        }\n      }\n      // #tag Bookshelf\n      if (this.data.IsBookshelf()) {\n        if (config.Debug) console.log(\"Bookshelf page detected\");\n        this.handleBookshelf();\n      }\n\n      // if not match any pattern\n      if (\n        !this.data.Book.Is() &&\n        !this.data.Info.Is() &&\n        !this.data.End.Is() &&\n        !this.data.IsBookshelf()\n      ) {\n        if (!config.Debug) {\n          alert(t(\"noMatchingPattern\"));\n        }\n      }\n    } catch (error) {\n      console.error(error);\n      if (!config.Debug) {\n        alert(`${t(\"errorOccurred\")}${String(error)}`);\n      }\n    }\n  }\n\n  /**\n   * 書頁自動化處理：樣式、導航、元素移除、書櫃、作者連結、下一頁鏈接\n   */\n  private handleBookPage(): void {\n    if (config.IsHookAlert) this.hookAlert();\n    this.addStyles();\n    this.modifyPageNavigation();\n    removeElement(\n      \".mytitle\",\n      \".top_Scroll\",\n      \"#pagefootermenu\",\n      \"body > div.container > div > div.yueduad1\",\n      \"#pageheadermenu\",\n      \".bottom-ad2\",\n      \"body > div.container > div.yuedutuijian.light\"\n    );\n    if (this.data.IsTwkan) {\n      removeElement(\"#container > br\");\n    }\n    if (config.AutoAddBookcase) this.autoAddToBookcase();\n    this.insertAuthorLink();\n    this.updateNextPageLink();\n    if (this.data.IsTwkan) {\n      const raw_replace_json = GM_getResourceText(\"replace_json\");\n      let replace_json: {\n        [key: string]: string;\n      } = {};\n      try {\n        replace_json = JSON.parse(raw_replace_json);\n      } catch (error) {\n        if (error instanceof SyntaxError) {\n          if (config.Debug) {\n            console.log(error);\n          } else {\n            alert(error);\n          }\n        } else {\n          throw error;\n        }\n      }\n      if (config.Debug) {\n        console.log(\"replace_json: \", replace_json);\n      }\n\n      for (const key in replace_json) {\n        if (Object.prototype.hasOwnProperty.call(replace_json, key)) {\n          const element = replace_json[key];\n          (document.querySelector(\"#txtcontent\") as HTMLDivElement).innerText =\n            (\n              document.querySelector(\"#txtcontent\") as HTMLDivElement\n            )?.innerText.replaceAll(key, element);\n        }\n      }\n    }\n  }\n\n  /**\n   * 自動加入書櫃（如未在封鎖名單）\n   */\n  private autoAddToBookcase(): void {\n    const aid = this.data.Book.GetAid();\n    if (!config.AutoAddBookcaseBlockade.includes(aid)) {\n      this.addBookcase();\n    } else {\n      console.log(\"Book is in the blockade list, not auto adding to bookcase.\");\n    }\n  }\n\n  /**\n   * 更新下一頁鏈接，附加FromBook參數\n   */\n  private updateNextPageLink(): void {\n    const nextPageEle = this.getNextPageElement();\n    if (nextPageEle) {\n      const href = new URL(nextPageEle.href);\n      href.searchParams.set(\"FromBook\", \"true\");\n      nextPageEle.href = href.toString();\n    }\n  }\n\n  /**\n   * 攔截全局alert，根據封鎖名單過濾\n   */\n  private hookAlert(): void {\n    const _alert: Function = alert;\n    unsafeWindow.alert = (...message: any) => {\n      if (\n        !config.HookAlertBlockade.some(\n          (blockade) =>\n            JSON.stringify(message) === JSON.stringify(blockade) ||\n            JSON.stringify(blockade) === \"*\"\n        )\n      ) {\n        _alert(...message);\n      }\n      if (config.Debug) console.log(\"Alert message:\", message);\n    };\n  }\n\n  /**\n   * 注入自定義CSS樣式\n   */\n  private addStyles(): void {\n    const css1 = GM_getResourceText(\"css1\");\n    GM_addStyle(css1);\n    if (config.Debug) console.log(\"CSS added\");\n  }\n\n  /**\n   * 移除原有onkeydown，註冊自定義鍵盤導航\n   */\n  private modifyPageNavigation(): void {\n    document.onkeydown = null;\n    addEventListener(\"keydown\", this.keydownHandler.bind(this));\n  }\n\n  /**\n   * 處理右鍵導航與結束自動關閉\n   */\n  private keydownHandler(e: KeyboardEvent): void {\n    if (!e.repeat && e.key === \"ArrowRight\") {\n      const nextPageLink = this.data.GetNextPageUrl();\n      if (nextPageLink) {\n        let href = new URL(nextPageLink);\n        href.searchParams.set(\"FromBook\", \"true\");\n        window.location.href = href.toString();\n      }\n      if (this.data.IsNextEnd()) {\n        if (config.IsEndClose) {\n          window.close();\n        }\n      }\n    }\n  }\n\n  /**\n   * 加入書櫃（根據不同站點呼叫不同API或模擬點擊）\n   */\n  private addBookcase(): void {\n    const aid = this.data.Book.GetAid();\n    const cid = this.data.Book.GetCid();\n    if (!addbookcase.toString().includes(\"Ajax.Tip\")) {\n      addbookcase(aid, cid);\n    } else {\n      const addBookcaseLink = document.querySelector(\n        \"#a_addbookcase\"\n      ) as HTMLElement | null;\n      addBookcaseLink?.click();\n    }\n  }\n\n  /**\n   * 替換標題div為帶有作者連結的新元素\n   */\n  private insertAuthorLink(): void {\n    const author =\n      document\n        .querySelector(this.SELECTORS.authorInfo)\n        ?.textContent?.trim()\n        .split(\" \")[1] ?? \"undefined\";\n    const authorLink = this.createAuthorLink(author);\n    const titleDiv = document.querySelector(\n      this.SELECTORS.titleDiv\n    ) as HTMLDivElement;\n    if (titleDiv) {\n      const titleLink = this.createTitleLink();\n      titleDiv.parentNode?.replaceChild(titleLink, titleDiv);\n    }\n  }\n\n  /**\n   * 建立作者頁面連結元素\n   */\n  private createAuthorLink(author: string): HTMLAnchorElement {\n    const authorLink = document.createElement(\"a\");\n    authorLink.href = `${\n      window.location.origin\n    }/modules/article/author.php?author=${encodeURIComponent(author)}`;\n    authorLink.textContent = author;\n    authorLink.style.color = \"#007ead\";\n    return authorLink;\n  }\n\n  /**\n   * 建立書名連結元素\n   */\n  private createTitleLink(): HTMLAnchorElement {\n    const titleLink = document.createElement(\"a\");\n    titleLink.innerHTML = this.data.HasBookInfo\n      ? bookinfo.articlename ?? document.title.split(\"-\")[0]\n      : document.title.split(\"-\")[0];\n    titleLink.classList.add(\"userjs_add\");\n    titleLink.id = \"title\";\n    titleLink.href = `${window.location.origin}/${\n      this.data.IsBiz ? \"b\" : \"book\"\n    }/${this.data.Book.GetAid()}.${\n      this.data.IsBiz || this.data.IsTwkan ? \"html\" : \"htm\"\n    }`;\n    return titleLink;\n  }\n\n  /**\n   * 書架頁面：收集書籍資料並註冊菜單\n   */\n  private async handleBookshelf(): Promise<void> {\n    const bookData = await this.collectBookData();\n    if (config.Debug) console.log(\"Bookshelf data collected\", bookData);\n    this.registerMenuCommand(bookData);\n  }\n\n  /**\n   * 搜尋功能：自動填入並提交表單\n   */\n  private performSearch(search: string): void {\n    const searchInput = document.querySelector(\n      this.SELECTORS.searchInput\n    ) as HTMLInputElement;\n    const searchForm = document.querySelector(\n      this.SELECTORS.searchForm\n    ) as HTMLFormElement;\n    if (searchInput && searchForm) {\n      searchInput.value = search;\n      searchForm.submit();\n    }\n  }\n\n  /**\n   * 遞迴收集書架書籍資料，最多重試5次\n   */\n  private async collectBookData(retryCount: number = 0): Promise<BookData[]> {\n    const books: Array<BookData> = [];\n    const labels = document.querySelectorAll(\"[id^='book_']\");\n    if (config.Debug) console.groupCollapsed(\"collectBookData\");\n    if (labels.length === 0) {\n      if (retryCount <= 5) {\n        console.warn(t(\"noLabelsFound\"));\n        await new Promise((resolve) => setTimeout(resolve, 5000));\n        return this.collectBookData(retryCount + 1);\n      } else {\n        console.error(t(\"maxRetriesReached\"));\n        return []; // 到達最大重試次數, 返回空陣列\n      }\n    }\n    if (config.Debug) {\n      console.log(labels);\n    }\n    labels.forEach((label) => {\n      const bookContainer = label;\n\n      const tmp = (function () {\n        if (\n          Array.from(label.querySelectorAll(\"label\")).find(\n            (label2) => label2.textContent === \"更新\"\n          )\n        ) {\n          // if (location.origin === \"https://www.69yuedu.net\") {\n          // } else {\n          const bookContinueEle = label.querySelector(\n            \"div.newright > a.btn.btn-tp\"\n          ) as HTMLAnchorElement;\n          const bookContinueLink = bookContinueEle.href;\n\n          const BookName = (\n            label.querySelector(\"div.newnav > h3 > a > span\") as HTMLSpanElement\n          ).textContent as string;\n\n          const bookImgEle = label.querySelector(\"a > img\") as HTMLImageElement;\n          const bookImgUrl = bookImgEle.src;\n          // }\n          return { bookContinueLink, BookName, bookImgUrl };\n        } else {\n          return false;\n        }\n      })();\n      if (tmp) {\n        const { bookContinueLink, BookName, bookImgUrl } = tmp;\n\n        const push_data: BookData = {\n          Updata: {\n            url: {\n              value: bookContinueLink,\n              URLParams: new URLSearchParams(bookContinueLink),\n            },\n          },\n          Mate: {\n            BookName: BookName,\n            BookHtmlObj: bookContainer,\n            BookImgUrl: bookImgUrl,\n          },\n        };\n        if (config.Debug) {\n          console.group(push_data.Mate.BookName);\n          console.log(push_data.Mate);\n          console.table(push_data.Updata);\n          console.groupEnd();\n        }\n\n        books.push(push_data);\n      }\n    });\n    if (config.Debug) console.groupEnd();\n    return books;\n  }\n\n  /**\n   * 註冊菜單命令，點擊可批量打開所有更新書籍\n   */\n  private registerMenuCommand(bookData: BookData[]) {\n    GM_registerMenuCommand(\n      `${\n        bookData.length === 0\n          ? t(\"noUpdates\")\n          : `${bookData.length}${t(\"updatesAvailable\")}`\n      }`,\n      () => {\n        bookData.forEach((data) => {\n          GM_openInTab(data.Updata.url.value);\n        });\n      }\n    );\n  }\n\n  /**\n   * 輸出調試資訊\n   */\n  private debugInfo() {\n    return {\n      IsBook: this.data.Book.Is(),\n      IsInfo: this.data.Info.Is(),\n      IsEnd: this.data.End.Is(),\n      IsNextEnd: this.data.IsNextEnd(),\n      IsBookshelf: this.data.IsBookshelf(),\n      HasBookinfo: this.data.HasBookInfo,\n      IsBiz: this.data.IsBiz,\n      IsTwkan: this.data.IsTwkan,\n      ...config,\n    };\n  }\n}\n\n// 初始化書籍管理器\nconst bookManager = new BookManager();\n"],"names":["Language","Config","Debug","GM_getValue","IsEndClose","AutoAddBookcase","AutoAddBookcaseBlockade","IsHookAlert","HookAlertBlockade","set","registerConfigMenu","key","value","menu","undefined","Object","values","includes","forEach","lang","GM_setValue","location","reload","setMenu","zh","en","config","i18nData","noMatchingPattern","errorOccurred","noLabelsFound","maxRetriesReached","noUpdates","updatesAvailable","i18nInstance","i18n","t","BookManager","getNextPageElement","selector","SELECTORS","nextPage","element","document","querySelector","href","Array","from","querySelectorAll","find","link","textContent","authorInfo","titleDiv","searchInput","searchForm","data","HasBookInfo","bookinfo","IsBookshelf","IsTwkan","URL","pathname","Book","GetAid","window","articleid","split","GetCid","chapterid","pattern","Is","test","Info","End","searchParams","get","h","GetNextPageUrl","nextPageEle","IsNextEnd","nextUrl","IsBiz","host","console","debug","debugInfo","search","URLSearchParams","performSearch","log","close","handleBookPage","Ele","click","handleBookshelf","alert","error","String","hookAlert","addStyles","modifyPageNavigation","removeElement","autoAddToBookcase","insertAuthorLink","updateNextPageLink","raw_replace_json","GM_getResourceText","replace_json","JSON","parse","SyntaxError","prototype","hasOwnProperty","call","innerText","replaceAll","aid","addBookcase","toString","_alert","unsafeWindow","message","some","blockade","stringify","css1","GM_addStyle","onkeydown","addEventListener","keydownHandler","bind","e","repeat","nextPageLink","cid","addbookcase","addBookcaseLink","author","trim","createAuthorLink","titleLink","createTitleLink","parentNode","replaceChild","authorLink","createElement","origin","encodeURIComponent","style","color","innerHTML","articlename","title","classList","add","id","bookData","collectBookData","registerMenuCommand","submit","retryCount","books","labels","groupCollapsed","length","warn","Promise","resolve","setTimeout","label","bookContainer","tmp","label2","bookContinueEle","bookContinueLink","BookName","bookImgEle","bookImgUrl","src","push_data","Updata","url","URLParams","Mate","BookHtmlObj","BookImgUrl","group","table","groupEnd","push","GM_registerMenuCommand","GM_openInTab","IsBook","IsInfo","IsEnd","HasBookinfo"],"mappings":"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"}